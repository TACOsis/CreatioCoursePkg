(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[78176,73308,50927,28546,6165,62832,40451,18070,95689,94260,71879,41421,63802,86183,8564,30945,53326,75707,98088,20469,42850,70422,48041,15184,92803,80898,58517,25660,3279,91374,68993,83231,5612,38469,60850,55795],{50347:(S,E,t)=>{t.d(E,{T:()=>o});var d=t(59131),m=t.n(d);const o=new d.InjectionToken("ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN")},47530:(S,E,t)=>{t.d(E,{X:()=>a});var d=t(96590),m=t.n(d),o=t(21018),y=t.n(o),c=t(23958),u=t.n(c),i=t(28399),v=t.n(i),h=t(50347),_=t(77989),s=t(59131),f=t.n(s);class a{get lastTransition(){return this._lastTransition}get length(){return this._items.length}constructor(e,r,l){this._window=e,this._featureValues=l,this._historyLimit=20,this._items=[],this._previous=-1,this._current=-1,r!==null&&(this._historyLimit=r),(this._window.__crtHistory??=[]).push(this)}_assertIndexedState(e){if(!("historyIndex"in e)||isNaN(e.historyIndex))throw new Error("History state should have historyIndex.")}_enforceHistoryLimit(){for(let e=this._current+1;e<this._items.length;e++)this.destroy(e);for(let e=0;e<this._current-this._historyLimit;e++)this.destroy(e)}destroy(e){const r=this._items[e];r?.view&&(r.view.destroy(),r.view=null)}_hasChildrenState(e){const r=e.state;return!(0,i.isEmpty)(r.children)}_getRootViewForChildrenRouting(){let e=!0;const r=this._items[this._current].state;for(let l=this._current-1;l>=0;l--){const g=this._items[l];if((0,i.isEmpty)(g)||!e)return null;if((0,c.crtStatesEqual)(r,g.state)&&e&&!(0,i.isEmpty)(g?.view?.pageRef))return g.view;e=this._hasChildrenState(g)}return null}goTo(e){this._assertIndexedState(e),this._previous=this._current,this._current=e.historyIndex;const r=this._current<this._previous,l=r&&!this._items[this._current],g=this._current===this._previous,M=this._current>this._previous;this._lastTransition={isBack:r,isReplace:g,isPush:M},!(e.silent&&!e._internalNotSilentIn8x&&!r)&&(g&&this.destroy(this._previous),(l||g||M)&&(this._items[this._current]={state:e}),M&&this._items.splice(this._current+1),this._enforceHistoryLimit())}canRestoreView(){const r=this._getCurrentView()?.pageRef;return this._current<this._previous&&!!r}_getCurrentView(){const e=this._items[this._current],r=this._hasChildrenState(e);let l;return r&&(0,i.isEmpty)(e?.view?.pageRef)&&(l=this._getRootViewForChildrenRouting()),l?new _.Pf(l.pageRef,e?.view?.modalRefs,l.schemaState,l.pageRefReusable,l.scrollPositions,this._featureValues):e?.view}getView(){if(!this.canRestoreView())throw new Error("Cannot restore view");return this._getCurrentView()}getViewByOffset(e){return this._items[this._current+e]?.view}validateBeforeStore(e){const r=this._items[this._current].view;if(r?.pageRef&&r?.pageRef!==e.pageRef)throw new Error("This history item already contain another view. If you want to change view, do replace history state first.")}storeView(e){this.validateBeforeStore(e),this._items[this._current].view=e}actualHistoryLength(){return this._items.filter(e=>e?.state?.moduleName)?.length}static{this.\u0275fac=function(r){return new(r||a)(s.\u0275\u0275inject(d.WINDOW_TOKEN),s.\u0275\u0275inject(h.T,8),s.\u0275\u0275inject(o.FEATURE_VALUES))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac})}}},37019:(S,E,t)=>{t.d(E,{p:()=>s});var d=t(73308),m=t(59131),o=t(20822),y=t(52552),c=t(21018),u=t(22438),i=t(10850),v=t(28399),h=t(62278),_=t(36486);class s extends y.BaseDataGridStateHandlerService{constructor(a,n,e,r,l,g,M){super(a),this._schemaPartsService=n,this._metadataModifierService=e,this._featureValues=r,this._dataGridDesignSettingsProvider=l,this._dataGridDesignSettingsUpdater=g,this._dataGridActiveFolderDesignSettingsProvider=M}_getActiveFolderDataGridDesignSettings(a){return this.viewModel$.pipe((0,_.switchMap)(n=>this._dataGridActiveFolderDesignSettingsProvider.get({viewConfig:a,viewModel:n,metadata:this.schemaService.schema})))}_saveSettingsForFolder(a,n){const{columns:e,viewElementConfig:r}=n,l=(0,v.cloneDeep)(e),g=a.columns?.map(p=>p?.viewMetadata);this._metadataModifierService.revert(l),this._setColumnsCaptionResourceMacros(l,g);const M=this._dataGridDesignSettingsUpdater.updateColumns(a,l,r);return this.viewModel$.pipe((0,_.switchMap)(p=>this._dataGridActiveFolderDesignSettingsProvider.set({viewConfig:r,viewModel:p,metadata:this.schemaService.schema},M)),(0,_.switchMap)(()=>this._schemaPartsService.commit({silent:!1})),(0,_.map)(()=>{}))}_setColumnsCaptionResourceMacros(a,n){(a??[]).filter(e=>e&&!(0,c.isResourceMacros)(e.caption)).forEach(e=>{const r=this._getColumnCaptionResourceKey(e,n);e.caption=(0,c.toResourceMacros)(r)})}_getColumnCaptionResourceKey(a,n){const e=n?.find(g=>g?.id&&g.id===a.id),r=(0,c.extractResourcesKey)(e?.caption),l=(0,o.createDataGridColumnCaptionResourceKey)(a);return r||l}_saveSettingsToProfile(a){var n=this;return(0,d.A)(function*(){const{columns:e,viewElementConfig:r}=a,l=(0,v.cloneDeep)(e);let g=l?.some(D=>D.changed);const M=yield n._dataGridDesignSettingsProvider.get(r.name),p=M.columns?.map(D=>D?.viewMetadata).filter(Boolean);n._metadataModifierService.revert(l),n._setColumnsCaptionResourceMacros(l,p),g=g||l?.length!==p?.length;const R=n._dataGridDesignSettingsUpdater.updateColumns(M,l,r);yield n._dataGridDesignSettingsProvider.save(r.name,R),yield n._schemaPartsService.commit({silent:g===!1})})()}innerHandle(a){return this._featureValues.DisableDataGridSettingsByFolders?(0,h.from)(this._saveSettingsToProfile(a)):this._getActiveFolderDataGridDesignSettings(a.viewElementConfig).pipe((0,_.switchMap)(n=>n?this._saveSettingsForFolder(n,a):this._saveSettingsToProfile(a)))}handle(a,n){return super.handle({...a},n)}static{this.\u0275fac=function(n){return new(n||s)(m.\u0275\u0275inject(u.SchemaService),m.\u0275\u0275inject(u.SchemaPartsService),m.\u0275\u0275inject(i.MetadataModifierService),m.\u0275\u0275inject(c.FEATURE_VALUES),m.\u0275\u0275inject(o.DataGridDesignSettingsProvider),m.\u0275\u0275inject(o.DataGridDesignSettingsUpdater),m.\u0275\u0275inject(o.DataGridActiveFolderDesignSettingsProvider))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac})}}},77989:(S,E,t)=>{t.d(E,{OG:()=>m,X8:()=>d,pU:()=>c,Pf:()=>y});class d{constructor(i){i&&(this.title=i.title,this.schemaName=i.schemaName)}}class m{}var o=t(62278);class y{constructor(i=null,v=new Map,h=i?.instance?.schemaState,_=!1,s=i?.instance?.scrollPositions,f={}){this.pageRef=i,this.modalRefs=v,this.schemaState=h,this.pageRefReusable=_,this.scrollPositions=s,this._featureValues=f,this.isDestroyed=!1}_destroyModalViews(){const i=this?.modalRefs;i?.size&&(Array.from(i.values()).forEach(v=>v.close()),this.modalRefs.clear())}_destroyViewModelAsync(i){return this._featureValues.DisableHandleFixedViewModelResumePauseRequest?i?.destroy().pipe((0,o.take)(1)):(0,o.concat)(i?.pause()??(0,o.of)(),i?.destroy()??(0,o.of)()).pipe((0,o.take)(2))}destroy(){if(this._destroyModalViews(),this.pageRefReusable){const i=this.pageRef?.instance?.schemaComponent;this.schemaState.viewModel&&(i?.clearResources(this.schemaState.viewModel),this._destroyViewModelAsync(this.schemaState.viewModel).subscribe()),this.schemaState.viewModel=null,this.schemaState.models=null,this.schemaState=null}else{const i=this.pageRef?.instance?.schemaComponent?.schemaState;this._destroyViewModelAsync(i?.viewModel).subscribe(),this.pageRef?.destroy(),this.pageRef?.hostView?.destroy(),this.pageRef=null}this.isDestroyed=!0}get viewModel(){return this._featureValues?.UseSchemaOutletReuseViewStrategy?this?.schemaState?.viewModel:this?.pageRef?.instance?.schemaState?.viewModel}}class c extends Error{constructor(i){super(i),Object.setPrototypeOf(this,c.prototype)}}},31418:(S,E,t)=>{t.d(E,{P:()=>o});var d=t(59131),m=t.n(d);class o{constructor(){this._repository=new Map}set(c,u){this._repository.set(c,u)}get(c){return this._repository.get(c)}getAll(){return Array.from(this._repository.values())}static{this.\u0275fac=function(u){return new(u||o)}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}}},26958:(S,E,t)=>{t.d(E,{j:()=>v});var d=t(59131),m=t.n(d),o=t(10850),y=t.n(o),c=t(36486),u=t.n(c),i=t(31418);class v extends o.DataSourceFactoryService{constructor(_,s,f){super(s,f),this._dataSourceRepository=_}create(_,s,f){return super.create(_,s,f).pipe((0,c.tap)(a=>{this._dataSourceRepository.set(_,a)}))}static{this.\u0275fac=function(s){return new(s||v)(d.\u0275\u0275inject(i.P),d.\u0275\u0275inject(d.Injector),d.\u0275\u0275inject(o.DataSourceTypeResolver))}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac})}}},25343:(S,E,t)=>{t.d(E,{$:()=>i});var d=t(50456),m=t(21018),o=t(10850),y=t(62278),c=t(31418),u=t(59131);class i extends d.DataSourceStructureExplorerService{constructor(h,_,s,f){super(),this._dataSourceRepository=h,this._dataSchemaRepository=_,this._entityBackwardReferenceService=s,this._featureValues=f}getDataSchemaAttributeByPath(h){return(0,y.throwError)(new Error("Method not implemented"))}getDataSchemaByName(h){return this._dataSchemaRepository.get(h)}getDataSourceByName(h){return(0,y.of)(this._dataSourceRepository.get(h))}getDataSources(){return(0,y.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(h){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(h):(0,y.of)([])}static{this.\u0275fac=function(_){return new(_||i)(u.\u0275\u0275inject(c.P),u.\u0275\u0275inject(o.DataSchemaRepositoryService),u.\u0275\u0275inject(d.EntityBackwardReferenceService),u.\u0275\u0275inject(m.FEATURE_VALUES))}}static{this.\u0275prov=u.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac})}}},70765:(S,E,t)=>{t.d(E,{U:()=>h});var d=t(96590),m=t(21018),o=t(10850),y=t(23958),c=t(28399),u=t(62278),i=t(47530),v=t(59131);class h extends o.ViewModelDataDelayer{constructor(s,f,a,n){super(),this._crtRouter=s,this._routerOutletHistory=f,this._featureValues=a,this._window=n,this._disableDelayingModelEventsFeatureName="DisableDelayingModelEvents",this._disableDelayingModelsEventFeatureState=!1,this._disableOffsetForDelayingModelEventsFeatureName="DisableOffsetForDelayingModelEvents",this._disableOffsetForDelayingModelEventsFeatureState=!1,this._defaultViewLoadingOffset=-1,this._subscriptions=new u.Subscription,this._loadTriggerSubject=new u.Subject,this.loadTrigger$=this._loadTriggerSubject.asObservable(),this._isAngularHost=(0,c.get)(this._window,"Terrasoft")?.isAngularHost,this._isAngularHost&&(this._initFeatureStates(),this._disableDelayingModelsEventFeatureState||this._subscribeOnNavigation())}setViewModel(s){this._viewModel||(this._viewModel=s)}_initFeatureStates(){this._disableDelayingModelsEventFeatureState=this._featureValues[this._disableDelayingModelEventsFeatureName]??!1,this._disableDelayingModelsEventFeatureState||(this._disableOffsetForDelayingModelEventsFeatureState=this._featureValues[this._disableOffsetForDelayingModelEventsFeatureName]??!1),this._viewLoadingOffset=this._disableOffsetForDelayingModelEventsFeatureState?0:this._defaultViewLoadingOffset}_shouldLoadForModals(s,f){return s&&s.modalRefs?Array.from(s.modalRefs.values()).some(a=>a?.componentInstance?.page?.schemaState?.viewModel===f):!1}_shouldLoadForPage(s,f){return s?.viewModel===f}_getViews(){const s=[];for(let f=this._viewLoadingOffset;f<=0;f++)s.push(this._routerOutletHistory.getViewByOffset(f));return s}_shouldLoadForViews(){const s=(0,o.getRootViewModel)(this._viewModel);return this._getViews().some(a=>{const n=this._shouldLoadForPage(a,s),e=this._shouldLoadForModals(a,s);return n||e})}_shouldLoad(){return this?._routerOutletHistory?this._shouldLoadForViews():!1}_subscribeOnNavigation(){this._subscriptions.add(this._crtRouter?.navigateEnd$.subscribe(()=>{this._shouldLoad()&&this._loadTriggerSubject.next()}))}shouldBeDelayed(){return!this._isAngularHost||this._disableDelayingModelsEventFeatureState?!1:this._viewModel.State===o.ViewModelStates.Paused&&!this._shouldLoad()}setState(s,f){this._disableDelayingModelsEventFeatureState||s._setStateAttribute(f)}destroy(){this._subscriptions.unsubscribe(),this._loadTriggerSubject.complete(),this._viewModel=null}ngOnDestroy(){this.destroy()}static{this.\u0275fac=function(f){return new(f||h)(v.\u0275\u0275inject(y.CrtRouter,8),v.\u0275\u0275inject(i.X,8),v.\u0275\u0275inject(m.FEATURE_VALUES),v.\u0275\u0275inject(d.WINDOW_TOKEN))}}static{this.\u0275prov=v.\u0275\u0275defineInjectable({token:h,factory:h.\u0275fac})}}},73308:(S,E,t)=>{t.d(E,{A:()=>m});function d(o,y,c,u,i,v,h){try{var _=o[v](h),s=_.value}catch(f){c(f);return}_.done?y(s):Promise.resolve(s).then(u,i)}function m(o){return function(){var y=this,c=arguments;return new Promise(function(u,i){var v=o.apply(y,c);function h(s){d(v,u,i,h,_,"next",s)}function _(s){d(v,u,i,h,_,"throw",s)}h(void 0)})}}}}]);
